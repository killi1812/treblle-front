   # server {
   #   listen 80;
   #   server_name localhost; # Or domain
   #
   #   # Serve static files for the Vue app
   #   location / {
   #     root   /usr/share/nginx/html;
   #     index  index.html;
   #     try_files $uri $uri/ /index.html; # SPA fallback
   #   }
   #
   #   location /api/ {
   #     resolver 127.0.0.11 valid=30s;
   #     proxy_pass http://localhost:${PORT}/api/;
   #
   #     # Security headers NOTE: check first if not working
   #     add_header X-Frame-Options "SAMEORIGIN" always;
   #     add_header X-Content-Type-Options "nosniff" always;
   #     add_header X-XSS-Protection "1; mode=block" always;
   #
   #     proxy_set_header Host $host;
   #     proxy_set_header X-Real-IP $remote_addr;
   #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   #     proxy_set_header X-Forwarded-Proto $scheme;
   #   }
   # }
   #
server {
    listen 80;
    server_name localhost; # Or your domain

    # Increase max body size if needed for uploads, etc.
    client_max_body_size 10M;

    location / {
        root /usr/share/nginx/html;
        index  index.html;
        try_files $uri $uri/ /index.html;
        # return 404; 
    }

    location /api/ {
        proxy_pass http://backend:8090/api/; # Forward to backend service on port 8090
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 120s; # Increase timeout if needed
    }

     # Location block specifically for the external API proxy
    location /proxy/ {
        proxy_pass http://backend:8090/proxy/; # Forward to backend service's proxy handler
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 120s;
    }

    # Optional: Add location block for WebSocket if your chart service uses one under /api/ws/chart
    location /api/ws/ {
        proxy_pass http://backend:8090/api/ws/; # Forward WebSocket connections
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_read_timeout 86400s; # Longer timeout for persistent connections
    }
}
